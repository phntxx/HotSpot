<html>
  <head>
  </head>
  <body>
    <input type="text" id="name" placeholder="name">
    <input type="text" id="desc" placeholder="desc">
    <input type="text" id="high" placeholder="high">
    <button onclick="writedata()">POST</button>
    <a href="newlocation.html">MAP</a>
    <div id="out"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
    <script>

      var config = {
        apiKey: "AIzaSyAHMCGzbw2MjuAY304_dbzuPssyiETDMvM",
        authDomain: "hotspot-ac169.firebaseapp.com",
        databaseURL: "https://hotspot-ac169.firebaseio.com",
        projectId: "hotspot-ac169",
        storageBucket: "hotspot-ac169.appspot.com",
        messagingSenderId: "252315038762"
      };
      firebase.initializeApp(config);

      function getLocation(callback){
        if(navigator.geolocation){
          navigator.geolocation.getCurrentPosition(callback);
        }
      }

      function readdata(){
        firebase.database().ref('posts').on("child_added", function(snapshot) {
          var container = document.getElementById("out");
          if(snapshot.toJSON().created_at == new Date().toLocaleDateString()){
            var cell = document.createElement("div");
            var h1 = $('<h1/>', {text: snapshot.toJSON().name});
            $(cell).append(h1);
            var h2 = $('<h2/>', {text: snapshot.toJSON().up - snapshot.toJSON().down});
            $(cell).append(h2);
            var p1 = $('<p/>', {text: snapshot.toJSON().high});
            $(cell).append(p1);
            var p2 = $('<p/>', {text: snapshot.toJSON().desc});
            $(cell).append(p2);
            var up = $('<button/>', {click: function(){buttonclicked("up", snapshot.key, snapshot.toJSON().up)}, text: "UP"});
            $(cell).append(up);
            var down = $('<button/>', {click: function(){buttonclicked("down", snapshot.key, snapshot.toJSON().down)}, text: "DOWN"});
            $(cell).append(down);
            container.appendChild(cell);
          }
        });
      }

      function buttonclicked(action, id, current){
        if(action == "up"){
          firebase.database().ref().child('/posts/' + id).update({up: current + 1});
          window.location = "backend.html";
        } else if(action == "down"){
          firebase.database().ref().child('/posts/' + id).update({down: current + 1});
          window.location = "backend.html";
        }
      }

      function writedata(){
        var name = document.getElementById("name").value;
        var desc = document.getElementById("desc").value;
        var high = document.getElementById("high").value;

        function call(position){
          firebase.database().ref('posts').push({
            name: name,
            high: high,
            desc: desc,
            created_at: new Date().toLocaleDateString(),
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            up: 0,
            down: 0
          });
        }

        getLocation(call);
      }

      readdata();

    </script>
  </body>
</html>
